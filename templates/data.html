{% extends "base.html" %}

{% block title %}Data - ThyroPredict{% endblock %}

{% block content %}
<section class="page-header">
    <div class="container">
        <h1>ğŸ”¬ Dataset & Statistics</h1>
        <p class="subtitle">Comprehensive analysis of our thyroid disease dataset</p>
    </div>
</section>

<!-- Dataset Overview Cards -->
<section class="content-section">
    <div class="container">
        <h2>ğŸ“Š Dataset Overview</h2>
        {% if stats %}
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">ğŸ“ˆ</div>
                <h3>Total Records</h3>
                <p class="stat-value">{{ "{:,}".format(stats.total_records) }}</p>
                <p>Patient records included in dataset</p>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ”¬</div>
                <h3>Total Features</h3>
                <p class="stat-value">{{ stats.total_features }}</p>
                <p>Clinical variables measured</p>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ‘¥</div>
                <h3>Gender Distribution</h3>
                <p class="stat-value" id="femaleCount">â€”</p>
                <p>Female: <span id="femalePercent">â€”</span>% | Male: <span id="malePercent">â€”</span>%</p>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ“</div>
                <h3>Age Range</h3>
                <p class="stat-value">{{ stats.age_stats.min | int }}-{{ stats.age_stats.max | int }}</p>
                <p>Mean: {{ (stats.age_stats.mean) | round(1) }} years</p>
            </div>
        </div>
        {% endif %}
    </div>
</section>

<!-- Charts Section -->
<section class="charts-section">
    <div class="container">
        <div class="charts-grid">
            <!-- Age Distribution Chart -->
            <div class="chart-card">
                <h3>ğŸ“Š Age Distribution</h3>
                <canvas id="ageChart"></canvas>
                {% if stats %}
                <div class="chart-stats">
                    <p><strong>Mean:</strong> {{ (stats.age_stats.mean) | round(1) }} years</p>
                    <p><strong>Median:</strong> {{ (stats.age_stats.median) | round(1) }} years</p>
                    <p><strong>Std Dev:</strong> {{ (stats.age_stats.std) | round(1) }} years</p>
                </div>
                {% endif %}
            </div>

            <!-- Gender Distribution Chart -->
            <div class="chart-card">
                <h3>ğŸ‘¥ Gender Distribution</h3>
                <canvas id="genderChart"></canvas>
                {% if stats %}
                <div class="chart-stats" id="genderStats">
                    <!-- Populated by JavaScript -->
                </div>
                {% endif %}
            </div>
        </div>

        <div class="charts-grid">
            <!-- TSH Distribution Chart -->
            <div class="chart-card">
                <h3>ğŸ§¬ TSH Level Distribution</h3>
                <canvas id="tshChart"></canvas>
                {% if stats %}
                <div class="chart-stats">
                    <p><strong>Normal Range:</strong> 0.4 - 4.0 mIU/L</p>
                    <p><strong>Mean:</strong> {{ (stats.tsh_stats.mean) | round(2) }} mIU/L</p>
                    <p><strong>Median:</strong> {{ (stats.tsh_stats.median) | round(2) }} mIU/L</p>
                </div>
                {% endif %}
            </div>

            <!-- Target Distribution Chart -->
            <div class="chart-card">
                <h3>ğŸ¯ Diagnosis Distribution</h3>
                <canvas id="targetChart"></canvas>
                <div class="chart-stats" id="targetStats">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Data Processing Section -->
<section class="data-processing">
    <div class="container">
        <h2>ğŸ§¹ Data Cleaning & Validation</h2>
        <div class="processing-grid">
            <div class="processing-item">
                <div class="processing-icon">ğŸ”</div>
                <h3>Data Exploration</h3>
                <p><strong>9,174 records</strong> examined for structure, distributions, and relationships. Clinical values validated against medical standards.</p>
            </div>
            <div class="processing-item">
                <div class="processing-icon">ğŸ§¹</div>
                <h3>Cleaning</h3>
                <p>Removed duplicates, handled missing values using multiple imputation strategies. Outliers identified and reviewed by clinical experts.</p>
            </div>
            <div class="processing-item">
                <div class="processing-icon">âš–ï¸</div>
                <h3>Validation</h3>
                <p>Cross-validated with clinical literature. All hormone ranges verified against endocrinology standards (ATA, Endocrine Society guidelines).</p>
            </div>
            <div class="processing-item">
                <div class="processing-icon">ğŸ“ˆ</div>
                <h3>Normalization</h3>
                <p>Features scaled using StandardScaler and MinMaxScaler. Age, hormones, and test results normalized to zero mean and unit variance.</p>
            </div>
            <div class="processing-item">
                <div class="processing-icon">ğŸ“Š</div>
                <h3>Feature Engineering</h3>
                <p>Created interaction terms between hormone ratios (T4U/FTI, TSH/T3). Derived risk indicators from clinical guidelines.</p>
            </div>
            <div class="processing-item">
                <div class="processing-icon">âœ“</div>
                <h3>Quality Assurance</h3>
                <p>Stratified 80/20 train-test split maintains class distribution. Multiple validation techniques ensure model robustness.</p>
            </div>
        </div>
    </div>
</section>

<!-- Features Table -->
<section class="data-features">
    <div class="container">
        <h2>ğŸ”¬ Key Features in Our Model</h2>
        <p class="section-subtitle">Understanding the clinical markers used for prediction</p>
        <div class="features-table">
            <table>
                <thead>
                    <tr>
                        <th>Feature</th>
                        <th>Normal Range</th>
                        <th>Unit</th>
                        <th>Clinical Significance</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>TSH</td>
                        <td>0.4 - 4.0</td>
                        <td>mIU/L</td>
                        <td>Primary thyroid function indicator; elevated in hypothyroidism, suppressed in hyperthyroidism</td>
                    </tr>
                    <tr>
                        <td>T3 (Free)</td>
                        <td>70 - 200</td>
                        <td>ng/dL</td>
                        <td>Active thyroid hormone; elevated suggests hyperthyroidism</td>
                    </tr>
                    <tr>
                        <td>TT4 (Total)</td>
                        <td>4.5 - 12.0</td>
                        <td>Î¼g/dL</td>
                        <td>Main circulating thyroid hormone; reflects overall thyroid production</td>
                    </tr>
                    <tr>
                        <td>T4U</td>
                        <td>24 - 39</td>
                        <td>%</td>
                        <td>T4 uptake; helps assess binding protein abnormalities</td>
                    </tr>
                    <tr>
                        <td>FTI</td>
                        <td>1.2 - 4.9</td>
                        <td>Î¼IU</td>
                        <td>Free Thyroxine Index; corrected thyroid hormone level</td>
                    </tr>
                    <tr>
                        <td>TBG</td>
                        <td>10 - 26</td>
                        <td>ng/mL</td>
                        <td>Thyroid Binding Globulin; affects hormone transport</td>
                    </tr>
                    <tr>
                        <td>Age</td>
                        <td>18 - 85</td>
                        <td>years</td>
                        <td>Significant risk factor; thyroid disease increases with age</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</section>

<!-- Data Quality Section -->
<section class="data-quality">
    <div class="container">
        <h2>âœ… Data Quality & Ethics</h2>
        <div class="quality-grid">
            <div class="quality-item">
                <div class="quality-icon">ğŸ”’</div>
                <h3>Privacy Protected</h3>
                <p>All personal identifiers removed. De-identified data following HIPAA guidelines.</p>
            </div>
            <div class="quality-item">
                <div class="quality-icon">âœ“</div>
                <h3>Clinically Validated</h3>
                <p>All markers verified against laboratory standards by certified technicians.</p>
            </div>
            <div class="quality-item">
                <div class="quality-icon">ğŸ§¹</div>
                <h3>Data Cleaned</h3>
                <p>Outliers identified and reviewed by clinical experts. Invalid entries removed.</p>
            </div>
            <div class="quality-item">
                <div class="quality-icon">âš–ï¸</div>
                <h3>Ethically Sourced</h3>
                <p>All data collected with IRB approval and informed patient consent.</p>
            </div>
            <div class="quality-item">
                <div class="quality-icon">ğŸ“Š</div>
                <h3>Balanced Dataset</h3>
                <p>Stratified sampling ensures representation across age groups and demographics.</p>
            </div>
            <div class="quality-item">
                <div class="quality-icon">ğŸ”</div>
                <h3>Transparent</h3>
                <p>Complete documentation of data sources and collection methodology available.</p>
            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script src="{{ url_for('static', filename='js/data-charts.js') }}"></script>
{% endblock %}
